<UserControl x:Class="Clash_WPF.Views.ConnectionView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <DockPanel Grid.Row="0" Margin="4,0,4,12">
            <TextBlock Text="连接" Style="{StaticResource PageTitle}" DockPanel.Dock="Left"/>
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Top">
                <Button Content="关闭全部" Style="{StaticResource DangerButton}"
                        Command="{Binding CloseAllCommand}" Margin="0,0,8,0"/>
                <Button Content="刷新" Style="{StaticResource PrimaryButton}"
                        Command="{Binding RefreshCommand}"/>
            </StackPanel>
        </DockPanel>

        <!-- Summary -->
        <Border Grid.Row="1" Style="{StaticResource Card}" Margin="4,0,4,12">
            <StackPanel Orientation="Horizontal">
                <TextBlock Foreground="{StaticResource TextSecondaryBrush}" FontSize="12" VerticalAlignment="Center">
                    <Run Text="活跃连接: "/><Run Text="{Binding ConnectionCount, Mode=OneWay}" Foreground="{StaticResource PrimaryBrush}" FontWeight="Bold"/>
                    <Run Text="    ↑ "/><Run Text="{Binding TotalUpload, Mode=OneWay}" Foreground="{StaticResource WarningBrush}"/>
                    <Run Text="    ↓ "/><Run Text="{Binding TotalDownload, Mode=OneWay}" Foreground="{StaticResource SuccessBrush}"/>
                </TextBlock>
            </StackPanel>
        </Border>

        <!-- Connections Table -->
        <DataGrid Grid.Row="2" ItemsSource="{Binding Connections}" Margin="4,0"
                  Style="{StaticResource ModernDataGrid}"
                  ColumnHeaderStyle="{StaticResource ModernColumnHeader}"
                  CellStyle="{StaticResource ModernDataGridCell}">
            <DataGrid.Columns>
                <DataGridTextColumn Header="主机" Binding="{Binding Host}" Width="*" MinWidth="180"/>
                <DataGridTextColumn Header="网络" Binding="{Binding Network}" Width="55"/>
                <DataGridTextColumn Header="类型" Binding="{Binding Type}" Width="60"/>
                <DataGridTextColumn Header="代理链" Binding="{Binding Chains}" Width="120"/>
                <DataGridTextColumn Header="规则" Binding="{Binding Rule}" Width="140"/>
                <DataGridTextColumn Header="↓ 下载" Binding="{Binding DownloadText}" Width="75"/>
                <DataGridTextColumn Header="↑ 上传" Binding="{Binding UploadText}" Width="75"/>
                <DataGridTextColumn Header="时间" Binding="{Binding StartTime}" Width="70"/>
                <DataGridTemplateColumn Header="" Width="50">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button Content="✕" FontSize="11" Padding="4,2" Cursor="Hand"
                                    Background="Transparent" Foreground="{StaticResource DangerBrush}"
                                    BorderThickness="0"
                                    Command="{Binding DataContext.CloseConnectionCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                    CommandParameter="{Binding}"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>
    </Grid>
</UserControl>
